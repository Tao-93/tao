(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{289:function(e,t,n){"use strict";n.r(t);var r=n(0),o=Object(r.a)({},(function(){var e=this.$createElement;this._self._c;return this._m(0)}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"ç™»å½•æ‹¦æˆªé€»è¾‘"}},[e._v("ç™»å½•æ‹¦æˆªé€»è¾‘")]),n("h2",{attrs:{id:"è·¯ç”±æ‹¦æˆª"}},[e._v("è·¯ç”±æ‹¦æˆª")]),n("p",[e._v("ä½ éœ€è¦å…ˆç”Ÿæˆè‡ªå·±çš„  ï¼ˆ"),n("strong",[e._v("[ç”ŸæˆToken]")]),e._v("ï¼‰ã€‚")]),n("p",[e._v("é¦–å…ˆåœ¨å®šä¹‰è·¯ç”±çš„æ—¶å€™å°±éœ€è¦å¤šæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å­—æ®µ"),n("code",[e._v("requireAuth")]),e._v("ï¼Œç”¨äºåˆ¤æ–­è¯¥è·¯ç”±çš„è®¿é—®æ˜¯å¦éœ€è¦ç™»å½•ã€‚å¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œåˆ™é¡ºåˆ©è¿›å…¥è·¯ç”±ï¼Œ å¦åˆ™å°±è¿›å…¥ç™»å½•é¡µé¢ã€‚")]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const routes = [\n    {\n        path: '/',\n        name: '/',\n        component: Index\n    },\n    {\n        path: '/repository',\n        name: 'repository',\n        meta: {\n            requireAuth: true,  // æ·»åŠ è¯¥å­—æ®µï¼Œè¡¨ç¤ºè¿›å…¥è¿™ä¸ªè·¯ç”±æ˜¯éœ€è¦ç™»å½•çš„\n        },\n        component: Repository\n    },\n    {\n        path: '/login',\n        name: 'login',\n        component: Login\n    }\n];\n")])])]),n("p",[e._v("å®šä¹‰å®Œè·¯ç”±åï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯åˆ©ç”¨"),n("code",[e._v("vue-router")]),e._v("æä¾›çš„é’©å­å‡½æ•°"),n("code",[e._v("beforeEach()")]),e._v("å¯¹è·¯ç”±è¿›è¡Œåˆ¤æ–­ã€‚")]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("router.beforeEach((to, from, next) => {\n    if (to.meta.requireAuth) {  // åˆ¤æ–­è¯¥è·¯ç”±æ˜¯å¦éœ€è¦ç™»å½•æƒé™\n        if (store.state.token) {  // é€šè¿‡vuex stateè·å–å½“å‰çš„tokenæ˜¯å¦å­˜åœ¨\n            next();\n        }\n        else {\n            next({\n                path: '/login',\n                query: {redirect: to.fullPath}  // å°†è·³è½¬çš„è·¯ç”±pathä½œä¸ºå‚æ•°ï¼Œç™»å½•æˆåŠŸåè·³è½¬åˆ°è¯¥è·¯ç”±\n            })\n        }\n    }\n    else {\n        next();\n    }\n})\n")])])]),n("p",[e._v("æ¯ä¸ªé’©å­æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š")]),n("ul",[n("li",[e._v("to: Route: å³å°†è¦è¿›å…¥çš„ç›®æ ‡ è·¯ç”±å¯¹è±¡")]),n("li",[e._v("from: Route: å½“å‰å¯¼èˆªæ­£è¦ç¦»å¼€çš„è·¯ç”±")]),n("li",[e._v("next: Function: ä¸€å®šè¦è°ƒç”¨è¯¥æ–¹æ³•æ¥ resolve è¿™ä¸ªé’©å­ã€‚æ‰§è¡Œæ•ˆæœä¾èµ– next æ–¹æ³•çš„è°ƒç”¨å‚æ•°ã€‚\n"),n("ul",[n("li",[e._v("next(): è¿›è¡Œç®¡é“ä¸­çš„ä¸‹ä¸€ä¸ªé’©å­ã€‚å¦‚æœå…¨éƒ¨é’©å­æ‰§è¡Œå®Œäº†ï¼Œåˆ™å¯¼èˆªçš„çŠ¶æ€å°±æ˜¯ confirmed ï¼ˆç¡®è®¤çš„ï¼‰ã€‚")]),n("li",[e._v("next(false): ä¸­æ–­å½“å‰çš„å¯¼èˆªã€‚å¦‚æœæµè§ˆå™¨çš„ URL æ”¹å˜äº†ï¼ˆå¯èƒ½æ˜¯ç”¨æˆ·æ‰‹åŠ¨æˆ–è€…æµè§ˆå™¨åé€€æŒ‰é’®ï¼‰ï¼Œé‚£ä¹ˆ URL åœ°å€ä¼šé‡ç½®åˆ° from è·¯ç”±å¯¹åº”çš„åœ°å€ã€‚")]),n("li",[e._v("next('/') æˆ–è€… next({ path: '/' }): è·³è½¬åˆ°ä¸€ä¸ªä¸åŒçš„åœ°å€ã€‚å½“å‰çš„å¯¼èˆªè¢«ä¸­æ–­ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªæ–°çš„å¯¼èˆªã€‚")])])])]),n("p",[n("strong",[e._v("ç¡®ä¿è¦è°ƒç”¨ next æ–¹æ³•ï¼Œå¦åˆ™é’©å­å°±ä¸ä¼šè¢« resolvedã€‚")])]),n("blockquote",[n("p",[e._v("å®Œæ•´çš„æ–¹æ³•è§"),n("code",[e._v("/src/router.js")])])]),n("p",[e._v("å…¶ä¸­ï¼Œ"),n("code",[e._v("to.meta")]),e._v("ä¸­æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„"),n("code",[e._v("requireAuth")]),e._v("å­—æ®µã€‚é€šè¿‡è¿™ä¸ªå­—æ®µæ¥åˆ¤æ–­è¯¥è·¯ç”±æ˜¯å¦éœ€è¦ç™»å½•æƒé™ã€‚éœ€è¦çš„è¯ï¼ŒåŒæ—¶å½“å‰åº”ç”¨ä¸å­˜åœ¨tokenï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¿›è¡Œç™»å½•ã€‚ç™»å½•æˆåŠŸåè·³è½¬åˆ°ç›®æ ‡è·¯ç”±ã€‚")]),n("p",[e._v("ç™»å½•æ‹¦æˆªåˆ°è¿™é‡Œå°±ç»“æŸäº†å—ï¼Ÿå¹¶æ²¡æœ‰ã€‚è¿™ç§æ–¹å¼åªæ˜¯ç®€å•çš„å‰ç«¯è·¯ç”±æ§åˆ¶ï¼Œå¹¶ä¸èƒ½çœŸæ­£é˜»æ­¢ç”¨æˆ·è®¿é—®éœ€è¦ç™»å½•æƒé™çš„è·¯ç”±ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µä¾¿æ˜¯ï¼šå½“å‰tokenå¤±æ•ˆäº†ï¼Œä½†æ˜¯tokenä¾ç„¶ä¿å­˜åœ¨æœ¬åœ°ã€‚è¿™æ—¶å€™ä½ å»è®¿é—®éœ€è¦ç™»å½•æƒé™çš„è·¯ç”±æ—¶ï¼Œå®é™…ä¸Šåº”è¯¥è®©ç”¨æˆ·é‡æ–°ç™»å½•ã€‚ è¿™æ—¶å€™å°±éœ€è¦ç»“åˆ http æ‹¦æˆªå™¨ + åç«¯æ¥å£è¿”å›çš„http çŠ¶æ€ç æ¥åˆ¤æ–­ã€‚")]),n("h2",{attrs:{id:"æ‹¦æˆªå™¨"}},[e._v("æ‹¦æˆªå™¨")]),n("p",[e._v("è¦æƒ³ç»Ÿä¸€å¤„ç†æ‰€æœ‰httpè¯·æ±‚å’Œå“åº”ï¼Œå°±å¾—ç”¨ä¸Š axios çš„æ‹¦æˆªå™¨ã€‚é€šè¿‡é…ç½®"),n("code",[e._v("http response inteceptor")]),e._v("ï¼Œå½“åç«¯æ¥å£è¿”å›"),n("code",[e._v("401 Unauthorizedï¼ˆæœªæˆæƒï¼‰")]),e._v("ï¼Œè®©ç”¨æˆ·é‡æ–°ç™»å½•ã€‚")]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// http request æ‹¦æˆªå™¨\naxios.interceptors.request.use(\n    config => {\n        if (store.state.token) {  // åˆ¤æ–­æ˜¯å¦å­˜åœ¨tokenï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œåˆ™æ¯ä¸ªhttp headeréƒ½åŠ ä¸Štoken\n            config.headers.Authorization = `token ${store.state.token}`;\n        }\n        return config;\n    },\n    err => {\n        return Promise.reject(err);\n    });\n\n// http response æ‹¦æˆªå™¨\naxios.interceptors.response.use(\n    response => {\n        return response;\n    },\n    error => {\n        if (error.response) {\n            switch (error.response.status) {\n                case 401:\n                    // è¿”å› 401 æ¸…é™¤tokenä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢\n                    store.commit(types.LOGOUT);\n                    router.replace({\n                        path: 'login',\n                        query: {redirect: router.currentRoute.fullPath}\n                    })\n            }\n        }\n        return Promise.reject(error.response.data)   // è¿”å›æ¥å£è¿”å›çš„é”™è¯¯ä¿¡æ¯\n    });\n")])])]),n("blockquote",[n("p",[e._v("å®Œæ•´çš„æ–¹æ³•è§"),n("code",[e._v("/src/http.js")]),e._v(".")])]),n("p",[e._v("é€šè¿‡ä¸Šé¢è¿™ä¸¤æ­¥ï¼Œå°±å¯ä»¥åœ¨å‰ç«¯å®ç°ç™»å½•æ‹¦æˆªäº†ã€‚"),n("code",[e._v("ç™»å‡º")]),e._v("åŠŸèƒ½ä¹Ÿå°±å¾ˆç®€å•ï¼Œåªéœ€è¦æŠŠå½“å‰tokenæ¸…é™¤ï¼Œå†è·³è½¬åˆ°é¦–é¡µå³å¯ã€‚")]),n("p",[e._v("Now, let's try it ğŸ‘‰")])])}],!1,null,null,null);t.default=o.exports}}]);