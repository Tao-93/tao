<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机 | AlexTao 的 博客</title>
    <meta name="description" content="In doing we learn.">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/Weblog/assets/css/styles.05873600.css" as="style"><link rel="preload" href="/Weblog/assets/js/app.05873600.js" as="script"><link rel="preload" href="/Weblog/assets/js/6.829d0e7e.js" as="script"><link rel="prefetch" href="/Weblog/assets/css/16.styles.2339a627.css"><link rel="prefetch" href="/Weblog/assets/css/5.styles.c1152841.css"><link rel="prefetch" href="/Weblog/assets/css/7.styles.1f4a6057.css"><link rel="prefetch" href="/Weblog/assets/css/8.styles.5b6e1357.css"><link rel="prefetch" href="/Weblog/assets/js/0.a8dcd889.js"><link rel="prefetch" href="/Weblog/assets/js/10.fe0f74e6.js"><link rel="prefetch" href="/Weblog/assets/js/11.d51cd775.js"><link rel="prefetch" href="/Weblog/assets/js/12.01521323.js"><link rel="prefetch" href="/Weblog/assets/js/13.82c3fc4a.js"><link rel="prefetch" href="/Weblog/assets/js/14.3b16e4be.js"><link rel="prefetch" href="/Weblog/assets/js/15.abf2374c.js"><link rel="prefetch" href="/Weblog/assets/js/16.2339a627.js"><link rel="prefetch" href="/Weblog/assets/js/17.f68b5694.js"><link rel="prefetch" href="/Weblog/assets/js/18.1dc877c8.js"><link rel="prefetch" href="/Weblog/assets/js/19.8d3a8eb9.js"><link rel="prefetch" href="/Weblog/assets/js/2.af3ad6a4.js"><link rel="prefetch" href="/Weblog/assets/js/20.b49a1359.js"><link rel="prefetch" href="/Weblog/assets/js/21.791ceaa2.js"><link rel="prefetch" href="/Weblog/assets/js/22.fc4cbaec.js"><link rel="prefetch" href="/Weblog/assets/js/23.4ad12214.js"><link rel="prefetch" href="/Weblog/assets/js/24.55bc5812.js"><link rel="prefetch" href="/Weblog/assets/js/25.f985eed7.js"><link rel="prefetch" href="/Weblog/assets/js/26.4cb7663f.js"><link rel="prefetch" href="/Weblog/assets/js/27.a14669b1.js"><link rel="prefetch" href="/Weblog/assets/js/28.8620d72f.js"><link rel="prefetch" href="/Weblog/assets/js/29.d0f2b69c.js"><link rel="prefetch" href="/Weblog/assets/js/3.fb06d288.js"><link rel="prefetch" href="/Weblog/assets/js/30.779bb068.js"><link rel="prefetch" href="/Weblog/assets/js/31.40c7de84.js"><link rel="prefetch" href="/Weblog/assets/js/32.ba7c27f0.js"><link rel="prefetch" href="/Weblog/assets/js/33.6ab2c1a8.js"><link rel="prefetch" href="/Weblog/assets/js/34.e8c873d7.js"><link rel="prefetch" href="/Weblog/assets/js/35.e96a75ad.js"><link rel="prefetch" href="/Weblog/assets/js/36.86fbcd91.js"><link rel="prefetch" href="/Weblog/assets/js/37.b26a2882.js"><link rel="prefetch" href="/Weblog/assets/js/38.992c347d.js"><link rel="prefetch" href="/Weblog/assets/js/39.e58d8f81.js"><link rel="prefetch" href="/Weblog/assets/js/4.b91b4b8a.js"><link rel="prefetch" href="/Weblog/assets/js/40.01c8b7bc.js"><link rel="prefetch" href="/Weblog/assets/js/41.75147100.js"><link rel="prefetch" href="/Weblog/assets/js/42.b2377431.js"><link rel="prefetch" href="/Weblog/assets/js/43.3a184450.js"><link rel="prefetch" href="/Weblog/assets/js/44.067bcf22.js"><link rel="prefetch" href="/Weblog/assets/js/45.68ba4476.js"><link rel="prefetch" href="/Weblog/assets/js/46.78e6e5f5.js"><link rel="prefetch" href="/Weblog/assets/js/47.08c79ff4.js"><link rel="prefetch" href="/Weblog/assets/js/48.24964852.js"><link rel="prefetch" href="/Weblog/assets/js/49.e7608465.js"><link rel="prefetch" href="/Weblog/assets/js/5.c1152841.js"><link rel="prefetch" href="/Weblog/assets/js/50.35c99ad9.js"><link rel="prefetch" href="/Weblog/assets/js/51.6b5dac05.js"><link rel="prefetch" href="/Weblog/assets/js/52.c4bb9237.js"><link rel="prefetch" href="/Weblog/assets/js/53.e53dd56d.js"><link rel="prefetch" href="/Weblog/assets/js/54.b8170212.js"><link rel="prefetch" href="/Weblog/assets/js/55.3f8a7f90.js"><link rel="prefetch" href="/Weblog/assets/js/56.70171628.js"><link rel="prefetch" href="/Weblog/assets/js/57.bfaf61b1.js"><link rel="prefetch" href="/Weblog/assets/js/58.db4b1b8a.js"><link rel="prefetch" href="/Weblog/assets/js/59.77684353.js"><link rel="prefetch" href="/Weblog/assets/js/60.6e9d6cac.js"><link rel="prefetch" href="/Weblog/assets/js/61.275c3154.js"><link rel="prefetch" href="/Weblog/assets/js/62.dd80ea43.js"><link rel="prefetch" href="/Weblog/assets/js/63.dbe8bf46.js"><link rel="prefetch" href="/Weblog/assets/js/64.14e4d91c.js"><link rel="prefetch" href="/Weblog/assets/js/65.c15a382b.js"><link rel="prefetch" href="/Weblog/assets/js/66.1eb3e94c.js"><link rel="prefetch" href="/Weblog/assets/js/67.3ae69c25.js"><link rel="prefetch" href="/Weblog/assets/js/68.2e02b211.js"><link rel="prefetch" href="/Weblog/assets/js/69.2016bf42.js"><link rel="prefetch" href="/Weblog/assets/js/7.1f4a6057.js"><link rel="prefetch" href="/Weblog/assets/js/70.8e2ebe5b.js"><link rel="prefetch" href="/Weblog/assets/js/8.5b6e1357.js"><link rel="prefetch" href="/Weblog/assets/js/9.93970f24.js">
    <link rel="stylesheet" href="/Weblog/assets/css/styles.05873600.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/Weblog/" class="home-link router-link-active"><!----><span class="site-name">
      AlexTao 的 博客
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/Weblog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Classify</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/Weblog/html_css/" class="nav-link">HTML/CSS</a></li><li class="dropdown-item"><!----><a href="/Weblog/javascript/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----><a href="/Weblog/node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----><a href="/Weblog/frames/" class="nav-link">Frames</a></li><li class="dropdown-item"><!----><a href="/Weblog/tool/" class="nav-link">Tool</a></li><li class="dropdown-item"><!----><a href="/Weblog/currency/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Currency</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/AlexTaoClub" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Weblog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Classify</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/Weblog/html_css/" class="nav-link">HTML/CSS</a></li><li class="dropdown-item"><!----><a href="/Weblog/javascript/" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----><a href="/Weblog/node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----><a href="/Weblog/frames/" class="nav-link">Frames</a></li><li class="dropdown-item"><!----><a href="/Weblog/tool/" class="nav-link">Tool</a></li><li class="dropdown-item"><!----><a href="/Weblog/currency/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Currency</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/AlexTaoClub" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>currency</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/Weblog/currency/" aria-current="page" class="active sidebar-link">计算机</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Weblog/currency/#浏览器缓存机制" class="sidebar-link">浏览器缓存机制</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/#tcp链接与释放（三次握手没四次挥手）" class="sidebar-link">TCP链接与释放（三次握手没四次挥手）</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/#http" class="sidebar-link">HTTP</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/#https" class="sidebar-link">HTTPS</a></li><li class="sidebar-sub-header"><a href="/Weblog/currency/#网站优化" class="sidebar-link">网站优化</a></li></ul></li><li><a href="/Weblog/currency/DevOps.html" class="sidebar-link">DevOps</a></li><li><a href="/Weblog/currency/前端安全.html" class="sidebar-link">前端安全</a></li><li><a href="/Weblog/currency/前端算法.html" class="sidebar-link">前端算法</a></li><li><a href="/Weblog/currency/函数实现.html" class="sidebar-link">函数实现</a></li><li><a href="/Weblog/currency/例题总结.html" class="sidebar-link">例题分析 </a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="计算机">计算机</h1><h2 id="浏览器缓存机制">浏览器缓存机制</h2><h3 id="缓存类型">缓存类型</h3><ol><li><p><strong>浏览器缓存</strong></p><p>简单来说，浏览器缓存就是把一个已经请求过的Web资源（如html页面，图片，js，数据等）拷贝一份副本储存在浏览器中。缓存会根据进来的请求保存输出内容的副本。当下一个请求来到的时候，如果是相同的URL，缓存会根据缓存机制决定是直接使用副本响应访问请求，还是向源服务器再次发送请求。（包括强缓存和协商缓存）</p></li><li><p><strong>CDN缓存</strong></p><p>CDN缓存一般是由网站管理员自己部署，为了让网站更容易扩展并获得更好的性能。通常情况下，浏览器先向CDN网关发起Web请求，网关服务器后面对应着一台或多台负载均衡源服务器，会根据它们的负载请求，动态将请求转发到合适的源服务器上。从浏览器角度来看，整个CDN就是一个源服务器，从这个层面来说，浏览器和服务器之间的缓存机制，在这种架构下同样适用。</p></li><li><p><strong>代理服务器缓存</strong></p><p>代理服务器是浏览器和源服务器之间的中间服务器，浏览器先向这个中间服务器发起Web请求，经过处理后（比如权限验证，缓存匹配等），再将请求转发到源服务器。代理服务器缓存的运作原理跟浏览器的运作原理差不多，只是规模更大。</p></li><li><p><strong>数据库缓存</strong></p><p>数据库缓存是指，当web应用的关系比较复杂，数据库中的表很多的时候，如果频繁进行数据库查询，很容易导致数据库不堪重荷。为了提供查询的性能，将查询后的数据放到内存中进行缓存，下次查询时，直接从内存缓存直接返回，提供响应效率。</p></li><li><p><strong>应用层缓存</strong></p><p>应用层缓存是指我们在代码层面的缓存，通过代码逻辑。把曾经请求国的数据或资源等，缓存起来，再次需要数据是通过逻辑上的处理选择可用的缓存数据。</p></li></ol><h3 id="概念">概念</h3><ul><li>强缓存-------用户发送的请求直接从客户端获取，不发送请求去服务端，不予服务器发生交互。</li><li>协商缓存----用户发送的请求，发送到服务器后，由服务器判定是否从缓存中获取资源。</li><li>共同点：数据都是从客户端获取。</li><li>不同点：强缓存不与服务器发生交互，二协商缓存需要与服务器交互。</li></ul><h3 id="强缓存">强缓存</h3><ul><li><p>谷歌控制台network选项中请求返回200，并且size显示from disk cache或from memory cache。</p><pre><code>  **from memory cache** 代表内存中的缓存

  **from disk cache** 代表硬盘中的缓存
  
  浏览器读取缓存的顺序为 memory---&gt;disk。
  
  在浏览器中，浏览器会在js和图片等文件解析执行后直接存入内存缓存中，那么当刷新页面时只需直接从内存缓存中读取(from memory cache)；而css文件则会存入硬盘文件中，所以每次渲染页面都需要从硬盘读取缓存(from disk cache)。
</code></pre></li><li><p>相关header</p><ul><li><p><strong>expires</strong>：reponse header 里的过期时间，浏览器再次加载资源时，没如果在这个过期时间内，则命中强缓存。它的值为一个绝对时间的GMT格式的时间字符串，比如：Expires：Sat, 29 Dec 2018 09:10:50 GMT</p></li><li><p><strong>Cache-Control</strong>：在HTTP/1.1中，Cache-Control主要控制网页缓存。比如当Cache-concral：max-age300表示这个请求正确返回时间（浏览器也会记录下来）的5分钟再次加载资源，就会你命中强缓存。常见6个属性：</p><ul><li>publice：所有内容都将被缓存（客户端和代理服务器都可缓存）。具体来说响应可被任何中间节点缓存，如 Browser &lt;-- proxy1 &lt;--  proxy2 &lt;-- Server，中间的proxy可以缓存资源，比如下次再请求同一资源proxy1直接把自己缓存的东西给 Browser 而不再向proxy2要。</li><li>private：所有内容只有客户端可以缓存，Cache-Control的默认取值。具体来说，表示中间节点不允许缓存，对于Browser &lt;-- proxy1 &lt;-- proxy2 &lt;-- Server，proxy 会老老实实把Server 返回的数据发送给proxy1,自己不缓存任何数据。当下次Browser再次请求时proxy会做好请求转发而不是自作主张给自己缓存的数据。</li><li>no-cache：客户端缓存内容，是否使用缓存则需要经过协商缓存来验证决定。表示不使用 Cache-Control的缓存控制方式做前置验证，而是使用 Etag 或者Last-Modified字段来控制缓存。需要注意的是，no-cache这个名字有一点误导。设置了no-cache之后，并不是说浏览器就不再缓存数据，只是浏览器在使用缓存数据时，需要先确认一下数据是否还跟服务器保持一致。</li><li>no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存</li><li>max-age=xxx (xxx is numeric)表示缓存内容将在xxx秒后失效</li><li>s-maxage：（单位为s)：同max-age，只用于共享缓存（比如CDN缓存）。比如当s-maxage=60时，在这60秒中，即使更新了CDN的内容，浏览器也不会进行请求。max-age用于普通缓存，而s-maxage用于代理缓存。<strong>s-maxage的优先级高于max-age</strong>。如果存在s-maxage，则会覆盖掉max-age和Expires header。</li></ul><p><img src="/Weblog/assets/img/currency_02.6d2ab420.png" alt></p><pre><code>**Expires和Cache-Control两者对比**：区别在于 Expires 是http1.0的产物，Cache-Control是http1.1的产物，**两者同时存在的话，Cache-Control优先级高于Expires**；在某些不支持HTTP1.1的环境下，Expires就会发挥用处。所以Expires其实是过时的产物，现阶段它的存在只是一种兼容性的写法。
</code></pre></li></ul></li></ul><p>强缓存判断是否缓存的依据来自于是否超出某个时间或者某个时间段，而不关心服务器端文件是否已经更新，这可能会导致加载文件不是服务器端最新的内容，<strong>获知服务器端内容是否已经发生了更新需要用到协商缓存策略</strong></p><h3 id="协商缓存">协商缓存</h3><ul><li><p>协商缓存就是强制缓存失败后，浏览器携带缓存标识想服务器发送请求，由服务器根据缓存标识决定是否使用缓存的过程，主要以下两种情况：</p><ul><li>协商缓存生效返回304和Not Modified</li><li>协商缓存失效，返回200和请求结果</li></ul></li><li><p>相关header</p><ul><li><p>Last-Modified和Modified-Since</p><p>浏览器第一次访问资源时，服务器返回资源同时，在response header中添加Last-Modified的header，值是这个资源在服务器的最后修改时间，浏览器接收后缓存文件和header；</p><div class="language- extra-class"><pre class="language-text"><code>last-modified: Mon, 19 Nov 2018 12:04:48 GMT
</code></pre></div><p>浏览器下一次请求这个资源，浏览器检测到有 Last-Modified这个header，于是添加If-Modified-Since这个header，值就是Last-Modified中的值；服务器再次收到这个资源请求，会根据 If-Modified-Since 中的值与服务器中这个资源的最后修改时间对比，如果没有变化，返回304和空的响应体，直接从缓存读取，如果If-Modified-Since的时间小于服务器中这个资源的最后修改时间，说明文件有更新，于是返回新的资源文件和200。</p></li><li><p>ETag和If-None-Match</p><p>Etag是上一次加载资源时，服务器返回的response header，是对该资源的一种唯一标识，只要资源有变化，Etag就会重新生成。浏览器在下一次加载资源向服务器发送请求时，会将上一次返回的Etag值放到request header里的If-None-Match里，服务器只需要比较客户端传来的If-None-Match跟自己服务器上该资源的ETag是否一致，就能很好地判断资源相对客户端而言是否被修改过了。如果服务器发现ETag匹配不上，那么直接以常规GET 200回包形式将新的资源（当然也包括了新的ETag）发给客户端；如果ETag是一致的，则直接返回304知会客户端直接使用本地缓存即可。</p><p><strong>Etag与Lat-Modified</strong> 对比：</p></li></ul><ol><li>精度。Etag优于Lat-Modified。Last-Modified的时间单位是秒，如果某个文件在1秒内改变了多次，那么他们的Last-Modified其实并没有体现出来修改，但是Etag每次都会改变确保了精度；如果是负载均衡的服务器，各个服务器生成的Last-Modified也有可能不一致。</li><li>性能。Etag逊于Lat-Modified,Last-Modified只需要记录时间，而Etag需要服务器通过算法来计算出一个hash值。</li><li>优先级，服务器校验有限Etag。</li></ol></li></ul><h3 id="缓存机制">缓存机制</h3><p><strong>强制缓存优先于协商缓存进行，若强制缓存(Expires和Cache-Control)生效则直接使用缓存，若不生效则进行协商缓存(Last-Modified / If-Modified-Since和Etag / If-None-Match)，协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么代表该请求的缓存失效，返回200，重新返回资源和缓存标识，再存入浏览器缓存中；生效则返回304，继续使用缓存</strong>。</p><p><img src="/Weblog/assets/img/currency_03.861c54cd.png" alt></p><h3 id="用户行为对浏览器缓存的影响">用户行为对浏览器缓存的影响</h3><p>如果资源已经被浏览器缓存下来，在缓存失效之前，再次请求时，默认会先检查是否命中强缓存，如果强缓存命中则直接读取缓存，如果强缓存没有命中则发请求到服务器检查是否命中协商缓存，如果协商缓存命中，则告诉浏览器还是可以从缓存读取，否则才从服务器返回最新的资源。这是默认的处理方式，这个方式可能被浏览器的行为改变：</p><ol><li>地址栏访问，链接跳转是正常用户行为，将会触发浏览器缓存机制；</li><li>F5刷新，浏览器会设置max-age=0，跳过强缓存判断，会进行协商缓存判断；</li><li>ctrl+F5刷新，跳过强缓存和协商缓存，直接从服务器拉取资源。</li></ol><h2 id="tcp链接与释放（三次握手没四次挥手）">TCP链接与释放（三次握手没四次挥手）</h2><p>TCP是<strong>主机对主机层的传输控制协议</strong>，提供可靠的连接服务，采用三次握手确认建立一个连接，与之相反的，采用四次挥手来断开连接：
<strong>TCP标志位</strong>有6种标示，即：SYN(建立联机) 、 ACK(确认) 、 PSH(传送) 、 FIN(f结束) 、 RST(重置) 、 URG(紧急) 、 Sequence number(顺序号码) 、 Acknowledge number(确认号码)。</p><p><strong>TCP链接三个阶段：</strong></p><ol><li>建立链接</li><li>数据传输</li><li>释放链接</li></ol><p>客户（client）：主动发起连接建立的应用进程。
服务器（server）：被动等待连接建立的应用进程。</p><h3 id="三次握手">三次握手</h3><p>为了准确无误的将数据发送到指定IP处，TCP协议采用了三次握手的策略，如下步骤所示：</p><ol><li>客户端采用TCP协议将带有SYN标志的数据包发送给服务器，等待服务器的确认。</li><li>服务器端在收到SYN的数据包后，必须确认SYN，即自己发送的ACK标志，同时，自己也将会向客户端发送一个SYN标志。</li><li>客户端在接收到服务器短的SYN+ACK包后，自己会向服务器发送ACK包，完成三次握手。那么客户端和服务器正式建立了连接，开始传输数据。</li></ol><p><img src="/Weblog/assets/img/20180514133040211.1437af3c.jpg" alt></p><h3 id="四次挥手">四次挥手</h3><p>用来断开服务器和客户端之间的通信的，之所以要断开连接，是因为TCP/IP 协议是要占用端口号的，而计算机的端口却是有限的，不进行断开的话，势必会造成计算机资源的浪费。</p><ol><li>在整个通信的过程中，谁先发起请求，谁就是客户端。
当客户端的数据传输到尾部时，客户端向服务器发送带有FIN标志的数据包，使其明白自己准备断开通信了。</li><li>因为TCP的通信是使用全双工通信的WebSocket，所以在断开连接的时候也应该是双向的；当服务器收到带有FIN标志的数据包时，其必不会直接发送FIN标志断开通信的请求，而是先发送一个带有ACK标志的应答信息，使客户端明白服务器还有数据要进行发送。</li><li>当 服务器的数据发送完成后，向客户端发送带有FIN标志的数据包，通知客户端断开连接。</li><li>当客户端收到FIN后，担心网络上某些不可控制的因素导致服务器不知道他要断开连接，会发送ACK进行确认，同时把自己设置成TIME_WAIT状态并启动定时器，在TCP的定时器到达后客户端并没有接收到请求，会重新发送；当服务器收到请求后就断开连接；当客户端等待2MLS（两倍报文最大生存时间）后，没有收到请求重传的请求后，客户端这边就断开连接，整个TCP通信就结束了。</li></ol><p><img src="/Weblog/assets/img/20180514140519698.bf2100fc.jpg" alt></p><h3 id="三次握手为什么不能改成两次握手？">三次握手为什么不能改成两次握手？</h3><p>解：三次握手中的每一次都是必须的。如果是两次握手，在第二次结束后，服务器并不能保证客户端已经收到了第二次的请求，如此一来的话，服务器会一直保存着这个通信过程，因为TCP通信都是要占用端口的，造成了一定的资源浪费。所以，就一定要让客户端来发送ACK的确认请求。</p><h3 id="关闭的时候为什么会是四次挥手？">关闭的时候为什么会是四次挥手？</h3><p>解：四次挥手不能像三次握手一样，三次握手可以将ACK+SYN 一起发送，ACK用于确认信息，SYN却是用来建立联机的；四次挥手中ACK是不能和FIN一起发送，ACK只是告诉客户端确认我收到了，等我将数据发送完毕之后会向其发送FIN的标志，所以四次挥手是不能够改变的。</p><h2 id="http">HTTP</h2><h3 id="简介：">简介：</h3><p>http请求是一个标准的<strong>客户端服务请求模式</strong>，也是常说的C/S结构：</p><p>HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网服务器传输文本到本地浏览器的传送协议。</p><p>HTTP是一个基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。</p><p>HTTP是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。</p><p>HTTP 协议是个无状态协议，不会保存状态。</p><h3 id="特点：">特点：</h3><ol><li>简单快速：客户端向服务端请求服务时，只需传送请求反方法和路径。请求方法：GET ,POST , HEAD，DELETE。含义分别是获取、修改、上传、删除，其中GET方式仅仅为获取服务器资源，方式较为简单，因此在请求方式为GET的HTTP请求数据中，请求正文部分可以省略，直接将想要获取的资源添加到URL中。</li><li>灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。</li><li>无连接：限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。</li><li>无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。</li><li>支持B/S及C/S模式：</li></ol><h3 id="http请求">HTTP请求</h3><ol><li>请求行，说明请求类型，访问资源以及使用HTTP的版本。</li><li>请求头部，紧接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息</li><li>空行，请求头部后面的空行是必须的</li><li>请求数据也叫主体，可以添加任意的其他数据。</li></ol><p><strong>栗子</strong></p><div class="language- extra-class"><pre class="language-text"><code>POST / HTTP1.1
Host:www.wrox.com
User-Agent:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022)
Content-Type:application/x-www-form-urlencoded
Content-Length:40
Connection: Keep-Alive

name=Professional%20Ajax&amp;publisher=Wiley
</code></pre></div><p>第一部分：请求行，是post请求，http1.1版本。
第二部分：请求头部，第二行至第六行。
第三部分：空行，第七行的空行。
第四部分：请求数据，第八行。</p><h3 id="http响应">HTTP响应</h3><ol><li>状态行</li><li>消息报头</li><li>空行</li><li>响应正文</li></ol><p><strong>栗子</strong></p><div class="language- extra-class"><pre class="language-text"><code>HTTP/1.1 200 OK
Date: Fri, 22 May 2009 06:07:21 GMT
Content-Type: text/html; charset=UTF-8

&lt;html&gt;
      &lt;head&gt;&lt;/head&gt;
      &lt;body&gt;
            &lt;!--body goes here--&gt;
      &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>第一部分：状态行，由HTTP协议版本号， 状态码， 状态消息 三部分组成。</p><p>​                   HTTP版本为1.1版本，状态码为200，状态消息为（ok）</p><p>第二部分：消息报头，用来说明客户端要使用的一些附加信息</p><p>​                第二行和第三行为消息报头，Date:生成响应的日期和时间；Content-Type:指定了MIME类型的              HTML(text/html),编码类型是UTF-8</p><p>第三部分：空行，消息报头后面的空行是必须的
第四部分：响应正文，服务器返回给客户端的文本信息。</p><p>​                  空行后面的html部分为响应正文。</p><h3 id="常见状态码">常见状态码</h3><p><strong>2XX 成功</strong></p><ul><li>200 OK，表示从客户端发来的请求在服务器端被正确处理</li><li>204 No content，表示请求成功，但响应报文不含实体的主体部分</li><li>205 Reset Content，表示请求成功，但响应报文不含实体的主体部分，但是与 204 响应不同在于要求请求方重置内容</li><li>206 Partial Content，进行范围请求</li></ul><p><strong>3XX 重定向</strong></p><ul><li>301 moved permanently，永久性重定向，表示资源已被分配了新的 URL</li><li>302 found，临时性重定向，表示资源临时被分配了新的 URL</li><li>303 see other，表示资源存在着另一个 URL，应使用 GET 方法丁香获取资源</li><li>304 not modified，表示服务器允许访问资源，但因发生请求未满足条件的情况//代表上次的文档已经被缓存了， 还可以继续使用，</li><li>307 temporary redirect，临时重定向，和302含义类似，但是期望客户端保持请求方法不变向新的地址发出请求</li></ul><p><strong>4XX 客户端错误</strong></p><ul><li>400 bad request，请求报文存在语法错误</li><li>401 unauthorized，表示发送的请求需要有通过 HTTP 认证的认证信息</li><li>403 forbidden，表示对请求资源的访问被服务器拒绝</li><li>404 not found，表示在服务器上没有找到请求的资源</li></ul><p><strong>5XX 服务器错误</strong></p><ul><li>500 internal sever error，表示服务器端在执行请求时发生了错误</li><li>501 Not Implemented，表示服务器不支持当前请求所需要的某个功能</li><li>503 service unavailable，表明服务器暂时处于超负载或正在停机维护，无法处理请求</li></ul><h3 id="http-头部">HTTP 头部</h3><table><thead><tr><th>通用字段</th><th>作用</th></tr></thead><tbody><tr><td>Cache-Control</td><td>控制缓存的行为</td></tr><tr><td>Connection</td><td>浏览器想要优先使用的连接类型，比如 <code>keep-alive</code></td></tr><tr><td>Date</td><td>创建报文时间</td></tr><tr><td>Pragma</td><td>报文指令</td></tr><tr><td>Via</td><td>代理服务器相关信息</td></tr><tr><td>Transfer-Encoding</td><td>传输编码方式</td></tr><tr><td>Upgrade</td><td>要求客户端升级协议</td></tr><tr><td>Warning</td><td>在内容中可能存在错误</td></tr></tbody></table><table><thead><tr><th>请求字段</th><th>作用</th></tr></thead><tbody><tr><td>Accept</td><td>能正确接收的媒体类型</td></tr><tr><td>Accept-Charset</td><td>能正确接收的字符集</td></tr><tr><td>Accept-Encoding</td><td>能正确接收的编码格式列表</td></tr><tr><td>Accept-Language</td><td>能正确接收的语言列表</td></tr><tr><td>Expect</td><td>期待服务端的指定行为</td></tr><tr><td>From</td><td>请求方邮箱地址</td></tr><tr><td>Host</td><td>服务器的域名</td></tr><tr><td>If-Match</td><td>两端资源标记比较</td></tr><tr><td>If-Modified-Since</td><td>本地资源未修改返回 304（比较时间）</td></tr><tr><td>If-None-Match</td><td>本地资源未修改返回 304（比较标记）</td></tr><tr><td>User-Agent</td><td>客户端信息</td></tr><tr><td>Max-Forwards</td><td>限制可被代理及网关转发的次数</td></tr><tr><td>Proxy-Authorization</td><td>向代理服务器发送验证信息</td></tr><tr><td>Range</td><td>请求某个内容的一部分</td></tr><tr><td>Referer</td><td>表示浏览器所访问的前一个页面</td></tr><tr><td>TE</td><td>传输编码方式</td></tr></tbody></table><table><thead><tr><th>响应字段</th><th>作用</th></tr></thead><tbody><tr><td>Accept-Ranges</td><td>是否支持某些种类的范围</td></tr><tr><td>Age</td><td>资源在代理缓存中存在的时间</td></tr><tr><td>ETag</td><td>资源标识</td></tr><tr><td>Location</td><td>客户端重定向到某个 URL</td></tr><tr><td>Proxy-Authenticate</td><td>向代理服务器发送验证信息</td></tr><tr><td>Server</td><td>服务器名字</td></tr><tr><td>WWW-Authenticate</td><td>获取资源需要的验证信息</td></tr></tbody></table><table><thead><tr><th>实体字段</th><th>作用</th></tr></thead><tbody><tr><td>Allow</td><td>资源的正确请求方式</td></tr><tr><td>Content-Encoding</td><td>内容的编码格式</td></tr><tr><td>Content-Language</td><td>内容使用的语言</td></tr><tr><td>Content-Length</td><td>request body 长度</td></tr><tr><td>Content-Location</td><td>返回数据的备用地址</td></tr><tr><td>Content-MD5</td><td>Base64加密格式的内容 MD5检验值</td></tr><tr><td>Content-Range</td><td>内容的位置范围</td></tr><tr><td>Content-Type</td><td>内容的媒体类型</td></tr><tr><td>Expires</td><td>内容的过期时间</td></tr><tr><td>Last_modified</td><td>内容的最后修改时间</td></tr></tbody></table><h3 id="get与post区别">GET与POST区别</h3><ul><li>GET从指定的资源请求数据，POST 向指定的资源提交要被处理的数据。</li><li>GET在浏览器回退时是无害的，而POST会再次提交请求。</li><li>GET产生的URL地址可以被当作书签，而POST不可以。</li><li>GET请求参数会被完整保留在浏览器历史记录里，而POST中的参数不会被保留。</li><li><strong>GET请求会被浏览器主动cache，而POST不会，除非手动设置</strong>。</li><li>URL有长度限制，会影响 Get 请求，但是这个长度限制是浏览器规定的，不是 RFC 规定的。</li><li>对参数的数据类型，GET只接受ASCII字符，而POST支持更多的编码类型且不对数据类型限制。</li><li>GET参数通过URL传递么，不适合用来传递敏感信息，POST放在Request body中，可以传输更多数据且相对安全。</li><li>GET产生一个TCP数据包，浏览器会把http header和data一并发送出去，服务器响应200(返回数据); POST产生两个TCP数据包，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok(返回数据)。</li></ul><h3 id="url详解">URL详解</h3><p>HTTP使用统一资源标识符（Uniform Resource Identifiers, URI）来传输数据和建立连接。URL是一种特殊类型的URI，包含了用于查找某个资源的足够的信息URL ,全称是UniformResourceLocator, 中文叫统一资源定位符,是互联网上用来标识某一处资源的地址。</p><div class="language- extra-class"><pre class="language-text"><code>schema://host          [:port#]/path/.../    [?query-string][#anchor]
https ://www.AlexTao.com:808080/news/index.asp?ID=06&amp;page=111#name
</code></pre></div><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>scheme</td><td>协议（http，HTTPS，ftp）</td></tr><tr><td>host</td><td>IP地址或者域名</td></tr><tr><td>port#</td><td>HTTP默认端口80，</td></tr><tr><td>path</td><td>访问资源的路径</td></tr><tr><td>query-string</td><td>发送服务器的数据</td></tr><tr><td>anchor</td><td>锚链接</td></tr></tbody></table><h3 id="http-请求-响应的步骤：">HTTP 请求/响应的步骤：</h3><ol><li><p>浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;(DNS)</p><p><strong>DNS查找过程如下</strong>：</p><ol><li><strong>浏览器缓存 –</strong> 浏览器会缓存DNS记录一段时间。 有趣的是，操作系统没有告诉浏览器储存DNS记录的时间，这样不同浏览器会储存个自固定的一个时间（2分钟到30分钟不等）。</li><li><strong>系统缓存</strong> – 如果在浏览器缓存里没有找到需要的记录，浏览器会做一个系统调用（windows里是gethostbyname）。这样便可获得系统缓存中的记录。</li><li><strong>路由器缓存</strong> – 接着，前面的查询请求发向路由器，它一般会有自己的DNS缓存。</li><li><strong>ISP DNS 缓存</strong> – 接下来要check的就是ISP缓存DNS的服务器。在这一般都能找到相应的缓存记录。</li><li><strong>递归搜索</strong> – 你的ISP的DNS服务器从跟域名服务器开始进行递归搜索，从.com顶级域名服务器到Facebook的域名服务器。一般DNS服务器的缓存中会有.com域名服务器中的域名，所以到顶级服务器的匹配过程不是那么必要了。</li></ol></li><li><p>解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;</p></li><li><p>浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;</p></li><li><p>服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;</p></li><li><p>释放 TCP连接;</p></li><li><p>浏览器将该 html 文本并显示内容;</p></li></ol><h2 id="https">HTTPS</h2><p>超文本传输安全协议（<code>HTTPS</code>，常称为 <code>HTTP over TLS/SSL</code>）是一种通过计算机网络进行安全通信的传输协议。<code>HTTPS</code> 经由 <code>HTTP</code> 进行通信，但利用 <code>SSL/TLS</code> 来加密数据包。<code>HTTPS</code> 开发的主要目的，是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。</p><p>HTTPS = HTTP+ 加密 + 认证 + 完整性保护</p><p>HTTP 加上加密处理和认证以及完整性保护后即是 HTTPS</p><h3 id="tls-ssl">TLS/SSL</h3><p><code>TCP (Transmission Control Protoco)</code> 传输层控制协议</p><p><code>TLS (Transport Layer Security)</code> 传输层安全协定</p><p><code>SSL (Secure Socket Layer)</code> 安全套接层</p><p><code>HTTP(Hypertext Transfer Protocol)</code> 基于 <code>TCP</code> 协议，无连接，每次连接只处理一个请求，结束后断开连接；无状态，无法保持用户状态，使用 <code>cookie</code> 和 <code>session</code> 解决。</p><p><code>HTTPS(HTTP over TLS/SSL)</code> 安全的 <code>http</code> 协议，<code>HTTP</code> 协议和 <code>TCP</code> 协议之间增加了 <code>TLS/SSL</code> 保证数据的安全传输。</p><h3 id="http-https-安全性">HTTP/HTTPS 安全性</h3><table><thead><tr><th>风险</th><th>描述</th><th>https解决方案</th></tr></thead><tbody><tr><td>窃听风险</td><td>攻击者可以获知消息内容（路由上的攻击者，可以偷窥到传输的消息内容。）</td><td>消息加密（对称加密算法，非对称加密算法）</td></tr><tr><td>篡改风险</td><td>攻击者可以篡改消息内容（消息加密以后攻击者无法获取消息内容的含义，但是可以篡改消息内容，篡改之后接收方也无法感知。）</td><td>消息摘要</td></tr><tr><td>冒充风险</td><td>攻击者可以冒充其他人参与通信（ 中间人攻击）</td><td>CA 身份认证</td></tr><tr><td>CA 不可信</td><td>信任的 CA 乱签发证书</td><td>证书锁</td></tr></tbody></table><h2 id="网站优化">网站优化</h2><ol><li>减少DNS查询:将服务器域名的ip信息加入本地host文件。</li><li>减少http请求数量，对于图片使用雪碧图,对于html文件和css文件，js文件分别进行合并操作。</li><li>减少下载时间：压缩图片，使用压缩应用压缩文档中的空格，删除文件多余的语句和注释，创造自己的js精简库和精简框架,使用本地浏览器缓存。</li><li>提前渲染开始时间：将css链接放在html头部。</li><li>减轻解析器的阻塞：将js链接放在body尾部。</li></ol><p>Now, let's try it 👉</p></div><div class="page-edit"><!----><div class="last-updated"><span class="prefix">Last Updated: </span><span class="time">9/20/2020, 12:22:33 PM</span></div></div><div class="page-nav"><p class="inner"><!----><span class="next"><a href="/Weblog/currency/DevOps.html">
          DevOps
        </a> →
      </span></p></div></div></div></div>
    <script src="/Weblog/assets/js/app.05873600.js" defer></script><script src="/Weblog/assets/js/6.829d0e7e.js" defer></script>
  </body>
</html>
